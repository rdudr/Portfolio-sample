<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Performance Check - Portfolio</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #1a1a1a;
      color: #ffffff;
      padding: 2rem;
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
      color: #ffffff;
    }

    h2 {
      font-size: 1.5rem;
      margin: 2rem 0 1rem;
      color: #e0e0e0;
      border-bottom: 2px solid #333;
      padding-bottom: 0.5rem;
    }

    .metric-card {
      background: #2a2a2a;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      border-left: 4px solid #4CAF50;
    }

    .metric-card.warning {
      border-left-color: #FFC107;
    }

    .metric-card.error {
      border-left-color: #F44336;
    }

    .metric-title {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #ffffff;
    }

    .metric-value {
      font-size: 2rem;
      font-weight: 700;
      margin: 0.5rem 0;
    }

    .metric-value.good {
      color: #4CAF50;
    }

    .metric-value.warning {
      color: #FFC107;
    }

    .metric-value.error {
      color: #F44336;
    }

    .metric-description {
      font-size: 0.875rem;
      color: #b3b3b3;
      margin-top: 0.5rem;
    }

    .metric-target {
      font-size: 0.875rem;
      color: #808080;
      margin-top: 0.25rem;
    }

    .button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 4px;
      font-size: 1rem;
      cursor: pointer;
      margin-right: 1rem;
      margin-bottom: 1rem;
    }

    .button:hover {
      background: #45a049;
    }

    .button.secondary {
      background: #2196F3;
    }

    .button.secondary:hover {
      background: #0b7dda;
    }

    .info-box {
      background: rgba(33, 150, 243, 0.1);
      border-left: 4px solid #2196F3;
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 4px;
    }

    .info-box h3 {
      margin-bottom: 0.5rem;
      color: #2196F3;
    }

    .info-box ul {
      margin-left: 1.5rem;
      color: #b3b3b3;
    }

    .info-box li {
      margin-bottom: 0.25rem;
    }

    .loading {
      text-align: center;
      padding: 2rem;
      color: #b3b3b3;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    code {
      background: #1a1a1a;
      padding: 0.25rem 0.5rem;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      color: #4CAF50;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üöÄ Performance Check</h1>
    <p style="color: #b3b3b3; margin-bottom: 2rem;">
      Requirements: 13.2, 13.4, 13.5 - Performance optimization verification
    </p>

    <div>
      <button class="button" onclick="runPerformanceCheck()">Run Performance Check</button>
      <button class="button secondary" onclick="checkFirstThreeRows()">Check First 3 Rows Load Time</button>
      <button class="button secondary" onclick="window.location.reload()">Refresh</button>
    </div>

    <div id="results"></div>

    <div class="info-box">
      <h3>Performance Targets</h3>
      <ul>
        <li><strong>First Contentful Paint (FCP):</strong> &lt; 1.5s</li>
        <li><strong>Largest Contentful Paint (LCP):</strong> &lt; 2.5s</li>
        <li><strong>Time to Interactive (TTI):</strong> &lt; 3.5s</li>
        <li><strong>First 3 Rows Load:</strong> &lt; 2s (Requirement 13.5)</li>
        <li><strong>Animation Frame Rate:</strong> 60fps (Requirement 13.4)</li>
        <li><strong>Image Size:</strong> &lt; 200KB each (Requirement 13.2)</li>
      </ul>
    </div>

    <div class="info-box">
      <h3>How to Use</h3>
      <ul>
        <li>Click "Run Performance Check" to measure core web vitals</li>
        <li>Click "Check First 3 Rows Load Time" to verify Requirement 13.5</li>
        <li>Open DevTools ‚Üí Performance tab for detailed analysis</li>
        <li>Run Lighthouse audit for comprehensive report</li>
      </ul>
    </div>
  </div>

  <script>
    // Performance metrics
    let performanceData = {
      fcp: null,
      lcp: null,
      tti: null,
      firstThreeRows: null,
      fps: null
    };

    // Run performance check
    function runPerformanceCheck() {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = '<div class="loading">Analyzing performance...</div>';

      setTimeout(() => {
        checkCoreWebVitals();
        checkAnimationPerformance();
        displayResults();
      }, 100);
    }

    // Check Core Web Vitals
    function checkCoreWebVitals() {
      // Get performance entries
      const perfEntries = performance.getEntriesByType('navigation')[0];
      const paintEntries = performance.getEntriesByType('paint');

      // First Contentful Paint
      const fcpEntry = paintEntries.find(entry => entry.name === 'first-contentful-paint');
      if (fcpEntry) {
        performanceData.fcp = (fcpEntry.startTime / 1000).toFixed(2);
      }

      // Largest Contentful Paint (using PerformanceObserver)
      if ('PerformanceObserver' in window) {
        try {
          const lcpObserver = new PerformanceObserver((list) => {
            const entries = list.getEntries();
            const lastEntry = entries[entries.length - 1];
            performanceData.lcp = (lastEntry.startTime / 1000).toFixed(2);
          });
          lcpObserver.observe({ entryTypes: ['largest-contentful-paint'] });
        } catch (e) {
          console.log('LCP observation not supported');
        }
      }

      // Time to Interactive (approximation)
      if (perfEntries) {
        const tti = perfEntries.domInteractive;
        performanceData.tti = (tti / 1000).toFixed(2);
      }
    }

    // Check animation performance (FPS)
    function checkAnimationPerformance() {
      let frameCount = 0;
      let lastTime = performance.now();
      let fps = 0;

      function countFrames() {
        frameCount++;
        const currentTime = performance.now();
        const elapsed = currentTime - lastTime;

        if (elapsed >= 1000) {
          fps = Math.round((frameCount * 1000) / elapsed);
          performanceData.fps = fps;
          frameCount = 0;
          lastTime = currentTime;
        }

        if (frameCount < 60) {
          requestAnimationFrame(countFrames);
        }
      }

      requestAnimationFrame(countFrames);
    }

    // Check first 3 rows load time
    function checkFirstThreeRows() {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = '<div class="loading">Measuring first 3 rows load time...</div>';

      // Open the main portfolio page in a new window
      const testWindow = window.open('../index-netflix.html', '_blank');
      
      if (!testWindow) {
        resultsDiv.innerHTML = `
          <div class="metric-card error">
            <div class="metric-title">‚ùå Test Failed</div>
            <div class="metric-description">
              Could not open test window. Please allow popups and try again.
            </div>
          </div>
        `;
        return;
      }

      // Measure load time
      const startTime = performance.now();
      
      testWindow.addEventListener('load', () => {
        setTimeout(() => {
          const endTime = performance.now();
          const loadTime = ((endTime - startTime) / 1000).toFixed(2);
          performanceData.firstThreeRows = loadTime;
          
          testWindow.close();
          displayFirstThreeRowsResult(loadTime);
        }, 500); // Wait for content to render
      });
    }

    // Display first 3 rows result
    function displayFirstThreeRowsResult(loadTime) {
      const resultsDiv = document.getElementById('results');
      const target = 2.0;
      const status = loadTime < target ? 'good' : loadTime < target * 1.5 ? 'warning' : 'error';
      const statusClass = loadTime < target ? '' : loadTime < target * 1.5 ? 'warning' : 'error';

      resultsDiv.innerHTML = `
        <h2>First 3 Rows Load Time (Requirement 13.5)</h2>
        <div class="metric-card ${statusClass}">
          <div class="metric-title">‚è±Ô∏è First 3 Rows Load Time</div>
          <div class="metric-value ${status}">${loadTime}s</div>
          <div class="metric-target">Target: &lt; 2.0s</div>
          <div class="metric-description">
            ${loadTime < target 
              ? '‚úì Excellent! First 3 rows load within target time.' 
              : loadTime < target * 1.5
              ? '‚ö†Ô∏è Close to target. Consider further optimization.'
              : '‚ùå Exceeds target. Optimization needed.'}
          </div>
        </div>
      `;
    }

    // Display results
    function displayResults() {
      const resultsDiv = document.getElementById('results');
      
      let html = '<h2>Performance Metrics</h2><div class="grid">';

      // FCP
      if (performanceData.fcp) {
        const fcpStatus = performanceData.fcp < 1.5 ? 'good' : performanceData.fcp < 2.5 ? 'warning' : 'error';
        const fcpClass = performanceData.fcp < 1.5 ? '' : performanceData.fcp < 2.5 ? 'warning' : 'error';
        html += `
          <div class="metric-card ${fcpClass}">
            <div class="metric-title">üé® First Contentful Paint</div>
            <div class="metric-value ${fcpStatus}">${performanceData.fcp}s</div>
            <div class="metric-target">Target: &lt; 1.5s</div>
            <div class="metric-description">
              ${performanceData.fcp < 1.5 ? '‚úì Excellent' : performanceData.fcp < 2.5 ? '‚ö†Ô∏è Needs improvement' : '‚ùå Poor'}
            </div>
          </div>
        `;
      }

      // LCP
      if (performanceData.lcp) {
        const lcpStatus = performanceData.lcp < 2.5 ? 'good' : performanceData.lcp < 4.0 ? 'warning' : 'error';
        const lcpClass = performanceData.lcp < 2.5 ? '' : performanceData.lcp < 4.0 ? 'warning' : 'error';
        html += `
          <div class="metric-card ${lcpClass}">
            <div class="metric-title">üñºÔ∏è Largest Contentful Paint</div>
            <div class="metric-value ${lcpStatus}">${performanceData.lcp}s</div>
            <div class="metric-target">Target: &lt; 2.5s</div>
            <div class="metric-description">
              ${performanceData.lcp < 2.5 ? '‚úì Excellent' : performanceData.lcp < 4.0 ? '‚ö†Ô∏è Needs improvement' : '‚ùå Poor'}
            </div>
          </div>
        `;
      }

      // TTI
      if (performanceData.tti) {
        const ttiStatus = performanceData.tti < 3.5 ? 'good' : performanceData.tti < 5.0 ? 'warning' : 'error';
        const ttiClass = performanceData.tti < 3.5 ? '' : performanceData.tti < 5.0 ? 'warning' : 'error';
        html += `
          <div class="metric-card ${ttiClass}">
            <div class="metric-title">‚ö° Time to Interactive</div>
            <div class="metric-value ${ttiStatus}">${performanceData.tti}s</div>
            <div class="metric-target">Target: &lt; 3.5s</div>
            <div class="metric-description">
              ${performanceData.tti < 3.5 ? '‚úì Excellent' : performanceData.tti < 5.0 ? '‚ö†Ô∏è Needs improvement' : '‚ùå Poor'}
            </div>
          </div>
        `;
      }

      // FPS
      if (performanceData.fps) {
        const fpsStatus = performanceData.fps >= 55 ? 'good' : performanceData.fps >= 45 ? 'warning' : 'error';
        const fpsClass = performanceData.fps >= 55 ? '' : performanceData.fps >= 45 ? 'warning' : 'error';
        html += `
          <div class="metric-card ${fpsClass}">
            <div class="metric-title">üé¨ Animation Frame Rate</div>
            <div class="metric-value ${fpsStatus}">${performanceData.fps} fps</div>
            <div class="metric-target">Target: 60 fps (Requirement 13.4)</div>
            <div class="metric-description">
              ${performanceData.fps >= 55 ? '‚úì Smooth animations' : performanceData.fps >= 45 ? '‚ö†Ô∏è Acceptable' : '‚ùå Choppy animations'}
            </div>
          </div>
        `;
      }

      html += '</div>';

      // Recommendations
      html += `
        <h2>Optimization Recommendations</h2>
        <div class="info-box">
          <h3>To improve performance:</h3>
          <ul>
            <li>Compress images to &lt; 200KB using <code>scripts/compress-images.sh</code></li>
            <li>Minify CSS and JS using <code>node scripts/minify-assets.js</code></li>
            <li>Use the minified versions in production</li>
            <li>Enable gzip/brotli compression on your server</li>
            <li>Use a CDN for static assets</li>
            <li>Implement HTTP/2 or HTTP/3</li>
            <li>Add resource hints (preload, prefetch, preconnect)</li>
          </ul>
        </div>
      `;

      resultsDiv.innerHTML = html;
    }

    // Auto-run on load
    window.addEventListener('load', () => {
      setTimeout(runPerformanceCheck, 1000);
    });
  </script>
</body>
</html>
